#!/usr/bin/env python
import logging
from skeleton.daemon import daemonize, argument_parser
from skeleton.skeleton import (load_config, schedule, wait_for_shutdown,
                               install_signal_handlers, configure_logging)
from skeleton import perform_useless_task

LOG = logging.getLogger(__name__)

args = argument_parser.parse_args()

if args.daemonize:
    daemonize(args.pidfile, args.error_log)

configure_logging()
install_signal_handlers()
config = load_config(args.config)

LOG.info('Starting')

schedule(lambda: perform_useless_task(config['server']['host']),
         period=config['period'], run_now=False)


wait_for_shutdown()
